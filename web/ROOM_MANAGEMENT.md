# 房间管理功能

## 🎯 新增功能

### 1. 创建房间增强

现在创建房间时可以配置更多选项：

#### 🔐 密码保护
- 为房间设置密码
- 设置后，用户必须输入正确密码才能加入
- 可选功能，留空则无需密码

#### 💾 持久化房间
- 选择是否持久化房间
- **持久化**：所有成员离开后房间仍然存在
- **非持久化**（默认）：最后一个成员离开后自动删除

### 2. 加入房间功能

#### 直接加入（房间列表）
- 点击房间列表中的房间快速加入
- 如果有密码保护，会显示 🔒 图标

#### 手动加入（输入房间号）
- 点击"加入"按钮
- 输入房间号和密码（如果需要）
- 可以加入不在列表中的房间

## 🎨 UI 改进

### 创建房间表单

```
┌─────────────────────────────────┐
│ ➕ 创建新房间                    │
├─────────────────────────────────┤
│ 房间 ID                         │
│ [dev-ops             ]          │
│                                 │
│ 房间名称                        │
│ [开发运维讨论          ]          │
│                                 │
│ 描述（可选）                     │
│ [讨论技术方案和部署问题 ]         │
│                                 │
│ 密码（可选）                     │
│ [••••••••••          ] 🔒       │
│                                 │
│ ☑ 持久化房间                    │
│   （所有人离开后不会自动删除）    │
│                                 │
│ [创建] [取消]                   │
└─────────────────────────────────┘
```

### 加入房间表单

```
┌─────────────────────────────────┐
│ 🚪 加入房间                      │
├─────────────────────────────────┤
│ 房间号                          │
│ [dev-ops             ]          │
│                                 │
│ 密码（如果房间有密码保护）        │
│ [••••••••••          ] 🔒       │
│                                 │
│ [🚪 加入] [取消]                │
└─────────────────────────────────┘
```

### 房间列表显示

```
┌─────────────────────────────────┐
│ #general                    3   │
│ General Discussion              │
│                                 │
│ #dev-ops 🔒           [持久] 2   │
│ 开发运维讨论                     │
│                                 │
│ #random                     1   │
│                                 │
└─────────────────────────────────┘

🔒 = 有密码保护
[持久] = 持久化房间
数字 = 当前成员数
```

## 📋 使用指南

### 创建持久化房间

1. 点击左侧边栏的"创建"按钮
2. 填写房间信息：
   - **房间 ID**：唯一标识符（必填）
   - **房间名称**：显示名称（必填）
   - **描述**：房间说明（可选）
   - **密码**：访问密码（可选）
3. 勾选"持久化房间"复选框 ✅
4. 点击"创建"

**效果**：
- 房间创建后会显示 `[持久]` 标签
- 即使所有人离开，房间也不会被删除
- 适合长期使用的讨论组

### 创建私密房间

1. 点击"创建"按钮
2. 填写房间信息
3. 在"密码"字段输入密码 🔐
4. 点击"创建"

**效果**：
- 房间会显示 🔒 锁图标
- 其他人必须输入正确密码才能加入
- 适合私密讨论或团队频道

### 加入房间（房间列表）

**无密码房间**：
- 直接点击房间名称即可加入 ✅

**有密码房间**（🔒 图标）：
- 点击后会提示输入密码
- 输入正确密码后加入

### 加入房间（手动输入）

**适用场景**：
- 房间不在列表中（新创建的房间）
- 私密房间（未公开）
- 知道房间号但看不到列表

**步骤**：
1. 点击左侧边栏的"加入"按钮 🚪
2. 输入房间号（例如：`dev-ops`）
3. 如果有密码，输入密码
4. 点击"加入"

## 🔧 技术实现

### 服务端消息格式

#### 创建房间

```json
{
  "type": "action",
  "from": "Alice",
  "payload": {
    "action": "room.create",
    "room_id": "dev-ops",
    "name": "开发运维讨论",
    "description": "讨论技术方案和部署问题",
    "password": "secret123",
    "persistent": true
  }
}
```

#### 加入房间

```json
{
  "type": "action",
  "from": "Bob",
  "payload": {
    "action": "room.join",
    "room_id": "dev-ops",
    "password": "secret123"
  }
}
```

### 房间数据结构

```typescript
interface Room {
  id: string                    // 房间 ID
  name: string                  // 房间名称
  description?: string          // 描述
  memberCount?: number          // 成员数量
  members?: string[]            // 成员列表
  persistent?: boolean          // 是否持久化
  hasPassword?: boolean         // 是否有密码
  createdAt?: string           // 创建时间
  createdBy?: string           // 创建者
}
```

### Hook 更新

**useAgentRoom.ts**:
```typescript
const createRoom = useCallback((
  roomId: string, 
  name: string, 
  description?: string, 
  password?: string,
  persistent?: boolean  // ← 新增参数
) => {
  // ...
}, [ws, authenticated, username])
```

## 🎯 使用场景

### 场景 1：团队协作空间

```
创建持久化、有密码的房间：
- 房间号：team-alpha
- 名称：Alpha 团队讨论
- 密码：alpha2026
- ✅ 持久化
- 效果：团队专属空间，长期存在
```

### 场景 2：临时讨论组

```
创建临时房间：
- 房间号：quick-chat
- 名称：临时讨论
- 密码：无
- ☐ 持久化（不勾选）
- 效果：所有人离开后自动删除
```

### 场景 3：公共聊天室

```
创建公开、持久化房间：
- 房间号：general
- 名称：General Discussion
- 密码：无
- ✅ 持久化
- 效果：任何人可以加入，长期存在
```

### 场景 4：私密会议

```
创建私密、临时房间：
- 房间号：meeting-2026
- 名称：2026 计划会议
- 密码：meeting123
- ☐ 持久化
- 效果：需要密码，会后自动删除
```

## ⚙️ 配置选项

| 选项 | 默认值 | 说明 |
|------|--------|------|
| 持久化 | `false` | 房间是否持久存在 |
| 密码 | 无 | 加入房间的访问密码 |
| 描述 | 可选 | 房间的详细说明 |

## 🔍 调试

### 查看房间信息

**浏览器控制台**（F12）：
```javascript
// 查看当前房间列表
console.log('Rooms:', rooms)

// 示例输出
[
  {
    id: "general",
    name: "General Discussion",
    memberCount: 3,
    persistent: true,
    hasPassword: false
  },
  {
    id: "dev-ops",
    name: "开发运维讨论",
    memberCount: 2,
    persistent: true,
    hasPassword: true
  }
]
```

### 测试密码功能

1. 创建带密码的房间
2. 打开另一个浏览器标签页
3. 尝试加入房间：
   - 不输入密码 → 失败 ❌
   - 输入错误密码 → 失败 ❌
   - 输入正确密码 → 成功 ✅

### 测试持久化

1. 创建持久化房间
2. 加入房间
3. 所有人离开房间
4. 刷新房间列表
5. ✅ 房间仍然存在

**对比**：
- 持久化房间：离开后仍在列表中 ✅
- 非持久化房间：离开后从列表消失 ❌

## 🎨 视觉指示

### 房间图标

| 状态 | 图标 | 说明 |
|------|------|------|
| 普通房间 | 💬 | 无特殊限制 |
| 密码保护 | 🔒 | 需要密码才能加入 |
| 持久化 | `[持久]` | 永久存在 |
| 当前房间 | 高亮 | 蓝色背景 |

### 按钮图标

| 按钮 | 图标 | 功能 |
|------|------|------|
| 刷新 | 🔄 | 刷新房间列表 |
| 创建 | ➕ | 创建新房间 |
| 加入 | 🚪 | 手动加入房间 |

## 📝 注意事项

### 密码管理

⚠️ **重要**：
- 密码以明文形式传输（在 WebSocket 消息中）
- 仅用于访问控制，不用于数据加密
- 生产环境建议使用 WSS（加密连接）

### 持久化限制

- 持久化房间会一直存在，直到手动删除
- 可能占用服务器资源
- 建议为不常用的持久化房间设置清理策略

### 房间号规范

建议使用：
- ✅ 小写字母和连字符：`dev-ops`
- ✅ 简短易记：`general`, `random`
- ❌ 避免特殊字符：`@#$%^&*`
- ❌ 避免空格：使用连字符代替

## 🚀 未来改进

### 计划功能

- [ ] 房间管理员权限
- [ ] 踢出成员功能
- [ ] 房间设置修改（密码、持久化）
- [ ] 房间删除功能
- [ ] 房间访客限制
- [ ] 房间消息历史记录
- [ ] 房间搜索功能
- [ ] 房间分类/标签

### 改进方向

- [ ] 密码强度提示
- [ ] 密码显示/隐藏切换
- [ ] 记住房间密码（本地存储）
- [ ] 房间收藏功能
- [ ] 最近访问房间列表

---

## 🎉 开始使用

1. **创建你的第一个持久化房间**
   ```
   房间号：my-first-room
   名称：我的第一个房间
   ✅ 持久化
   ```

2. **创建私密团队频道**
   ```
   房间号：team-secret
   名称：团队密室
   密码：team2026
   ✅ 持久化
   ```

3. **加入公共讨论**
   ```
   点击 general 房间
   ```

**享受增强的房间管理功能！** 🎊
